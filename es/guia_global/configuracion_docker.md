# üê≥ Configuraci√≥n con Docker/Podman

## üéØ Introducci√≥n

Docker (o Podman [[memory:8735666]]) proporciona una forma simple y portable de ejecutar Elixir y Livebook sin necesidad de instalar dependencias en tu sistema. Esta es una excelente opci√≥n si:

- Quieres un entorno aislado y reproducible
- Tienes dificultades con la instalaci√≥n local
- Quieres probar el curso antes de instalarlo permanentemente
- Trabajas en m√∫ltiples computadoras

## üìã Requisitos Previos

- Computadora con Windows, macOS o Linux
- Al menos 4 GB de RAM disponible
- 2-3 GB de espacio libre en disco
- Conexi√≥n a internet (solo para la primera configuraci√≥n)

## üîß Instalaci√≥n de Docker/Podman

### Opci√≥n A: Docker Desktop (Recomendado para principiantes)

#### Windows y macOS

1. **Descarga Docker Desktop:**
   - Ve a https://www.docker.com/products/docker-desktop
   - Descarga la versi√≥n para tu sistema operativo
   - Tama√±o aproximado: 400-500 MB

2. **Instala Docker Desktop:**
   - Ejecuta el instalador descargado
   - Sigue las instrucciones del asistente
   - Reinicia la computadora si se solicita

3. **Inicia Docker Desktop:**
   - Abre la aplicaci√≥n Docker Desktop
   - Acepta los t√©rminos de servicio
   - Espera a que Docker se inicie completamente (icono verde en la bandeja del sistema)

4. **Verifica la instalaci√≥n:**
   - Abre una terminal/PowerShell
   - Ejecuta:
     ```bash
     docker --version
     ```
   - Deber√≠as ver algo como: `Docker version 24.0.x`

#### Linux

```bash
# Ubuntu/Debian
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh
sudo usermod -aG docker $USER
# Cierra sesi√≥n y vuelve a iniciar para aplicar cambios

# Fedora
sudo dnf install docker-ce docker-ce-cli containerd.io
sudo systemctl start docker
sudo usermod -aG docker $USER

# Arch Linux
sudo pacman -S docker
sudo systemctl start docker
sudo usermod -aG docker $USER
```

### Opci√≥n B: Podman (Alternativa open-source)

Podman es una alternativa compatible con Docker, sin daemon y con mejor seguridad.

#### Linux

```bash
# Ubuntu/Debian
sudo apt-get install podman

# Fedora (viene preinstalado en versiones recientes)
sudo dnf install podman

# Arch Linux
sudo pacman -S podman
```

#### macOS

```bash
brew install podman
podman machine init
podman machine start
```

#### Windows

1. Descarga desde: https://github.com/containers/podman/releases
2. Instala el archivo `.msi`
3. Abre PowerShell y ejecuta:
   ```powershell
   podman machine init
   podman machine start
   ```

**Nota:** En el resto de esta gu√≠a, si usas Podman, simplemente reemplaza `docker` por `podman` en todos los comandos.

## üöÄ Configuraci√≥n de Livebook con Docker

### M√©todo 1: Usar la Imagen Oficial de Livebook (M√°s simple)

#### Ejecutar Livebook

```bash
docker run -p 8080:8080 -p 8081:8081 --pull always \
  -v $(pwd):/data \
  livebook/livebook
```

**En Windows PowerShell:**
```powershell
docker run -p 8080:8080 -p 8081:8081 --pull always -v ${PWD}:/data livebook/livebook
```

**Explicaci√≥n de los par√°metros:**
- `-p 8080:8080`: Expone el puerto de Livebook
- `-p 8081:8081`: Puerto adicional para comunicaci√≥n
- `--pull always`: Asegura tener la √∫ltima versi√≥n
- `-v $(pwd):/data`: Monta tu directorio actual para guardar notebooks
- `livebook/livebook`: La imagen oficial

#### Acceder a Livebook

1. Despu√©s de ejecutar el comando, ver√°s un mensaje en la terminal
2. Busca una l√≠nea como: `Access Livebook at http://localhost:8080/?token=...`
3. Copia esa URL completa
4. √Åbrela en tu navegador
5. ¬°Ya puedes usar Livebook!

#### Detener Livebook

- Presiona `Ctrl + C` en la terminal

### M√©todo 2: Docker Compose (Recomendado para uso frecuente)

#### Crear archivo de configuraci√≥n

1. Crea una carpeta para el curso:
   ```bash
   mkdir ElixirKidsCourse
   cd ElixirKidsCourse
   ```

2. Crea un archivo llamado `docker-compose.yml`:

```yaml
version: '3.8'

services:
  livebook:
    image: livebook/livebook:latest
    ports:
      - "8080:8080"
      - "8081:8081"
    environment:
      - LIVEBOOK_PASSWORD=elixirkids
      - LIVEBOOK_HOME=/data
    volumes:
      - ./notebooks:/data
    restart: unless-stopped
```

3. Crea la carpeta para notebooks:
   ```bash
   mkdir notebooks
   ```

#### Iniciar Livebook

```bash
docker-compose up -d
```

El par√°metro `-d` ejecuta Livebook en segundo plano.

#### Acceder a Livebook

1. Abre tu navegador
2. Ve a: http://localhost:8080
3. Ingresa la contrase√±a: `elixirkids`
4. ¬°Listo para programar!

#### Comandos √∫tiles

```bash
# Ver logs
docker-compose logs -f

# Detener Livebook
docker-compose down

# Reiniciar Livebook
docker-compose restart

# Ver estado
docker-compose ps
```

## üé® Configuraci√≥n Personalizada

### Cambiar el puerto

Si el puerto 8080 ya est√° en uso, modifica el archivo `docker-compose.yml`:

```yaml
ports:
  - "9090:8080"  # Cambia 9090 por el puerto que prefieras
  - "9091:8081"
```

Luego accede a: http://localhost:9090

### Configurar memoria

Si Livebook necesita m√°s memoria:

```yaml
services:
  livebook:
    # ... configuraci√≥n anterior ...
    deploy:
      resources:
        limits:
          memory: 2G
        reservations:
          memory: 1G
```

### Persistir datos

Para asegurar que tus notebooks no se pierdan:

```yaml
volumes:
  - ./notebooks:/data  # Notebooks y archivos
  - livebook_deps:/root/.mix  # Dependencias de Elixir
  
volumes:
  livebook_deps:
```

## üîç Verificaci√≥n

### Probar que funciona

1. Accede a Livebook en tu navegador
2. Haz clic en "New notebook"
3. Escribe en la primera celda:
   ```elixir
   IO.puts("¬°Docker funciona perfectamente!")
   System.version()
   ```
4. Presiona "Evaluate" o `Ctrl+Enter`
5. Deber√≠as ver el mensaje y la versi√≥n de Elixir

### Probar Kino

En una nueva celda:

```elixir
Mix.install([
  {:kino, "~> 0.12.0"}
])

Kino.Input.text("¬øC√≥mo te llamas?")
```

Si ves un campo de texto interactivo, ¬°todo funciona correctamente!

## üõ†Ô∏è Script de Inicio R√°pido

### Para Linux/macOS

Crea un archivo `start-livebook.sh`:

```bash
#!/bin/bash

# Colores para output
GREEN='\033[0;32m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

echo -e "${BLUE}üöÄ Iniciando Livebook...${NC}"

# Verificar si Docker est√° corriendo
if ! docker info > /dev/null 2>&1; then
    echo "Error: Docker no est√° corriendo. Por favor, inicia Docker Desktop."
    exit 1
fi

# Crear directorio de notebooks si no existe
mkdir -p notebooks

# Iniciar Livebook
docker run -d \
  --name elixir-kids-livebook \
  -p 8080:8080 \
  -p 8081:8081 \
  -e LIVEBOOK_PASSWORD=elixirkids \
  -v $(pwd)/notebooks:/data \
  livebook/livebook:latest

echo -e "${GREEN}‚úÖ Livebook iniciado correctamente${NC}"
echo -e "üì± Accede en: ${BLUE}http://localhost:8080${NC}"
echo -e "üîë Contrase√±a: elixirkids"
echo ""
echo "Para detener Livebook, ejecuta: docker stop elixir-kids-livebook"
```

Hazlo ejecutable:
```bash
chmod +x start-livebook.sh
./start-livebook.sh
```

### Para Windows

Crea un archivo `start-livebook.bat`:

```batch
@echo off
echo Iniciando Livebook...

REM Verificar si Docker est√° corriendo
docker info >nul 2>&1
if errorlevel 1 (
    echo Error: Docker no esta corriendo. Por favor, inicia Docker Desktop.
    pause
    exit /b 1
)

REM Crear directorio de notebooks
if not exist notebooks mkdir notebooks

REM Iniciar Livebook
docker run -d ^
  --name elixir-kids-livebook ^
  -p 8080:8080 ^
  -p 8081:8081 ^
  -e LIVEBOOK_PASSWORD=elixirkids ^
  -v %cd%/notebooks:/data ^
  livebook/livebook:latest

echo Livebook iniciado correctamente
echo Accede en: http://localhost:8080
echo Contrasena: elixirkids
echo.
echo Para detener Livebook, ejecuta: docker stop elixir-kids-livebook
pause
```

Ejecuta haciendo doble clic en el archivo.

## üîÑ Actualizaci√≥n

### Actualizar la imagen de Livebook

```bash
docker pull livebook/livebook:latest
```

O con docker-compose:
```bash
docker-compose pull
docker-compose up -d
```

## üöß Soluci√≥n de Problemas

### Docker Desktop no inicia

**Problema:** Docker Desktop se queda cargando.

**Soluci√≥n:**
1. Reinicia la computadora
2. Desactiva temporalmente el antivirus
3. En Windows, verifica que la virtualizaci√≥n est√© habilitada en la BIOS

### Puerto 8080 ya en uso

**Problema:** Error "port is already allocated"

**Soluci√≥n:**
```bash
# Ver qu√© usa el puerto
# Linux/macOS
lsof -i :8080

# Windows
netstat -ano | findstr :8080

# Cambiar el puerto en docker-compose.yml o usar:
docker run -p 9090:8080 ... livebook/livebook
```

### No puedo acceder a Livebook

**Problema:** El navegador no carga localhost:8080

**Soluci√≥n:**
1. Verifica que el contenedor est√° corriendo:
   ```bash
   docker ps
   ```
2. Verifica los logs:
   ```bash
   docker logs elixir-kids-livebook
   ```
3. Intenta acceder a: http://127.0.0.1:8080

### Los notebooks no se guardan

**Problema:** Al reiniciar Docker, los notebooks desaparecen.

**Soluci√≥n:**
Aseg√∫rate de usar el par√°metro `-v`:
```bash
-v $(pwd)/notebooks:/data
```

Verifica que la carpeta `notebooks` existe en tu directorio actual.

### Error "Cannot connect to Docker daemon"

**Problema:** Docker no responde.

**Soluci√≥n:**
- **Linux:** `sudo systemctl start docker`
- **macOS/Windows:** Inicia Docker Desktop manualmente

### Livebook muy lento

**Problema:** El rendimiento es bajo.

**Soluci√≥n:**
1. Asigna m√°s recursos a Docker:
   - Docker Desktop ‚Üí Settings ‚Üí Resources
   - Aumenta CPU y memoria (m√≠nimo 2 CPU, 4GB RAM)
2. Cierra otros contenedores:
   ```bash
   docker ps
   docker stop <contenedor-no-necesario>
   ```

## üí° Ventajas de usar Docker

‚úÖ **Aislamiento:** No interfiere con otras instalaciones en tu sistema

‚úÖ **Portabilidad:** Funciona igual en Windows, macOS y Linux

‚úÖ **Simplicidad:** No requiere instalar dependencias manualmente

‚úÖ **Reproducibilidad:** Mismo entorno para todos los estudiantes

‚úÖ **F√°cil de limpiar:** Eliminar el contenedor limpia todo

## ‚ö†Ô∏è Consideraciones

‚ùó **Rendimiento:** Ligeramente m√°s lento que instalaci√≥n nativa

‚ùó **Recursos:** Requiere Docker Desktop corriendo (usa memoria)

‚ùó **Complejidad inicial:** Curva de aprendizaje para entender Docker

‚ùó **Actualizaci√≥n:** Hay que actualizar la imagen manualmente

## üìÅ Organizaci√≥n Recomendada

```
ElixirKidsCourse/
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ start-livebook.sh (o .bat)
‚îî‚îÄ‚îÄ notebooks/
    ‚îú‚îÄ‚îÄ nivel_1/
    ‚îú‚îÄ‚îÄ nivel_2/
    ‚îú‚îÄ‚îÄ nivel_3/
    ‚îú‚îÄ‚îÄ mis_proyectos/
    ‚îî‚îÄ‚îÄ ejercicios_extra/
```

## üîÑ Backup de Notebooks

### Copia de seguridad manual

```bash
# Copiar todos los notebooks
cp -r notebooks notebooks-backup-$(date +%Y%m%d)
```

### Backup autom√°tico

Agrega esto al `docker-compose.yml`:

```yaml
services:
  livebook:
    # ... configuraci√≥n anterior ...
    volumes:
      - ./notebooks:/data
      - ./backups:/backups
```

## üìû Pr√≥ximos Pasos

1. ‚úÖ Verifica que Docker/Livebook funciona correctamente
2. ‚úÖ Crea la estructura de carpetas para los notebooks
3. ‚úÖ Descarga los notebooks del [Nivel 1](../nivel_1/README.md)
4. ‚úÖ Configura backups autom√°ticos
5. ‚úÖ ¬°Comienza a programar!

## üéì Recursos Adicionales

- [Documentaci√≥n oficial de Docker](https://docs.docker.com/)
- [Documentaci√≥n de Livebook](https://hexdocs.pm/livebook/)
- [Podman Documentation](https://docs.podman.io/)

---

**¬°Listo para programar con Docker! üê≥üöÄ**

